---
title: "HTTP通信からWebの仕組み、Railsがどう動くかまで体系的にまとめてみる。"
emoji: "👏"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ruby", "rails", "http", "web"]
published: false
---
# インターネットの仕組み
どのようにつながっているか..

> ![インターネットの仕組み](https://user-images.githubusercontent.com/77420123/159201734-43f5f228-841a-40d7-8a8f-38445e41cbad.jpeg)
引用 : 「コンピュータ用語学び塾」より

1. 無線ルータからプロバイダのサーバにつながる
2. サーバからインターネットへつながる
3. インターネットからそれぞれのサーバに繋がる
4. そのサーバーからデータを取得してデータが手元に返ってくる。

### どのように通信されているか
> ![OSI参照モデル](https://user-images.githubusercontent.com/77420123/159202205-82484285-d03e-46e7-a7c4-90d99ccd84c9.png)
引用 : 「Hatena Blog けんのへや」より

上記を『手紙を届ける』ということにたとえて説明していきます。

1. どんな手段で運ぶか?
これが、物理層・データリンク層（ネットワークインターフェイス層）に該当します。
:::message
具体的には、Ethernet・Wi-Fi等
> Ethernetとは、ネットワークやコンピューター間での通信モデル TCP/IPプロトコルのネットワークインターフェース層に対応する有線の規格のことです。以下が画像（多分見たことあるはず...）
![OSI参照モデル](https://user-images.githubusercontent.com/77420123/159202599-cb95327c-7da4-4a22-87c1-ea980a648018.jpeg)
:::

2. どこに運ぶか?
これが、ネットワーク層（インターネット層）に該当します。
ここで用いる概念が、IPアドレス（インターネットにおける住所）です。
> ![250px-Ipv4_address_ja svg](https://user-images.githubusercontent.com/77420123/159203160-97ed7eb8-b844-4485-a58e-3acf50f4efae.png)
引用 : 「Wikipedia」より

:::message
もう少し詳しく...
> IPアドレスは、IPネットワーク上の情報機器を識別するために指定するネットワーク層における識別用の番号である。
引用 : 「Wikipedia」より
:::

3. 何号室か?（マンション・アパートみたいなイメージです）
これが、トランスポート層に該当します。
ここで用いる概念が、ポート番号です。
以下のように役割は番号によって大体決まってます。
> ![port](https://user-images.githubusercontent.com/77420123/159203589-25b3a601-965a-400b-b8be-fb0c11119b85.jpeg)
引用 : 「エンジニアの入り口」より

:::message
特によく使用するものとして、80番のHTTPや443番のHTTPSなどがあります。
:::

4. 手紙の内容は?
書き方は、場面に応じてある程度決まってます。
それがプロトコルです。これはよく通信する上での『お約束』みたいにたとえられることがあります。他にも、『手順』とか『規約』とか。
> ![port2](https://user-images.githubusercontent.com/77420123/159204171-db46d51b-7b77-4963-8273-20080950bdf3.jpeg)
引用 : 「エンジニアの入り口」より

5. ここでようやく手紙が読まれる。
:::message
上記の1から5までのポイント
- CSI参照モデルは、パケットの中身の構造を示している。
- ネットワークのやりとりをするときにそれぞれの階層で決め事を決めておくことでやりとりができる。
:::

# Webの仕組み
### DNS（Domain Name System）
https://....みたいなよく目にするのがドメインです。
> DNS（ドメイン）とは、インターネットなどのIPネットワーク上でドメイン名（ホスト名）とIPアドレスの対応関係を管理するシステム
引用 : IT用語辞典

### どのようにドメインからIPアドレスが分かるか?
> ![zu01_02](https://user-images.githubusercontent.com/77420123/159205367-4a305ed1-3f86-463a-bdab-6094d8b5413b.jpeg)
引用 : 日経XTECH

1. 『"https://www.aaa.jp"のIPアドレスを教えて』とDNSサーバーに問い合わせする。
2. DNSサーバが色々なDNSサーバを経由して、IPアドレス（192.168.0.1）を教えてくれる。
3. IPアドレスでWebサーバにアクセスする。（ブラウザの裏で実行されている）

:::message
ここで宛先がわかったのでようやく、クライアントとWebサーバで通信できます。
:::

### HTTPの仕組み
> ![zu3-1](https://user-images.githubusercontent.com/77420123/159205883-ee394ef7-e9a3-42e4-b76a-9d570965a7a4.jpeg)
引用 : 日経XTECH

:::message
HTTP（HyperTextTransferProtocol）とは、HyperTextを転送する仕組みです。
:::

手順
1. HTTPリクエストを送る
:::message
HTTPリクエストはまず、リクエストメソッドでメソッドの定義をします。かつリクエストの中身は、HTTPリクエストヘッダとHTTPリクエストボディに分かれます。詳しくは場合により異なるので注釈を確認ください。[^1]
:::

2. HTTPレスポンスをもらう
:::message
HTTPレスポンスは、ステータスコード（状態を表すもの）とともにHTTPレスポンスを返し、中身は、HTTPレスポンスヘッダとHTTPレスポンスボディに分かれます。

HTTPレスポンスステータスコード
| ステータスコード | カテゴリ | 表記 | 説明 |
| ---- | ---- | ---- | ---- |
| 200 | 成功レスポンス | OK | リクエスト成功 |
| 204 | 成功レスポンス | No Content | レスポンスのコンテンツはないが、リクエストは成功 |
| 301 | リダイレクション | Moved Permanently | URLが永遠に変更されたので移動してね |
| 302 | リダイレクション | Found | URLが一時的に変更されたので移動してね |
| 403 | クライアントエラー | Forbidden | アクセス権がない |
| 404 | クライアントエラー | Not Found | リソースがない |
| 500 | サーバエラー | Internal Server Error | サーバ側で処理出来ないエラー |
| 502 | サーバエラー | Bad Gateway | サーバの通信状態にエラーがある |
| 503 | サーバエラー | Service Unavailable | サーバが処理できない |
| 504 | サーバエラー | Gateway Timeout | レスポンスのタイムアウト |
:::
3. クライアントに戻ってくる（手元のPCとか）

:::message
ローカルの開発でも、ローカルのWebサーバに対してHTTPリクエストを送って、HTTPレスポンスをもらって、ローカルのクライアント（ブラウザ）に戻ってくるという仕組みになっている。
※インターネットを返さなくても同じ仕組みになっている。
:::

:::message alert
[^1]: リクエストメソッドの内容によっては、HTTPリクエストボディとHTTPレスポンスボディのどちらか片方があったり、なかったりします。
以下の図を参考にしてください。
| リクエストメソッド | 説明 | リクエストボディ | レスポンスボディ |
| ---- | ---- | ---- | ---- |
| GET | データ取得 | × | ○ |
| POST | データ送信 | ○ | ○ |
| PUT | データ更新 | ○ | × |
| PATCH | データの一部更新 | ○ | ○ |
| DELETE | データ削除 | △ | △ |
| HEAD | ヘッダのみリクエスト | × | × |
> PUTとPATCHの違い
PUTは、データをすべて更新します。
PATCHは、データの一部を更新します。
※RailsのUpdateメソッドは、PATCHで動いています。
:::
